<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta content="Side channel stuff" name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=hegz.io name=base><meta content="hsl(270 50% 60%)" media="(prefers-color-scheme: light)" name=theme-color><meta content="hsl(27.567572 87% 67%)" media="(prefers-color-scheme: dark)" name=theme-color><title>Masking - SC-Wiki</title><link href=hegz.io/masking/ rel=canonical><meta content=Zola name=generator><link href="hegz.io/favicon.png?h=4b8b8481f5ac84986183" rel=icon type=image/png><link href="hegz.io/apple-touch-icon.png?h=be65d94454c9f3fe0ebb" type="image/png?h=be65d94454c9f3fe0ebb" rel=apple-touch-icon sizes=180x180><link as=font crossorigin href=hegz.io/fonts/geist.woff2 rel=preload type=font/woff2><link as=font crossorigin href=hegz.io/fonts/geist-mono.woff2 rel=preload type=font/woff2><link as=font crossorigin href=hegz.io/fonts/phosphor-bold.woff2 rel=preload type=font/woff2><style>:root{--accent-color:#96c;--accent-h:270;--accent-s:50%;--accent-l:60%}[data-theme=dark]{--accent-color:#f4a562;--accent-h:27.5676;--accent-s:87%;--accent-l:67%}@media (prefers-color-scheme:dark){:root:not([data-theme=light]){--accent-color:#f4a562;--accent-h:27.5676;--accent-s:87%;--accent-l:67%}}</style><link href="hegz.io/style.css?h=b6b0be85ae2753ad5323" rel=stylesheet><link href="hegz.io/phosphor-bold.css?h=64fb8156a3a3f0de62c5" rel=stylesheet><link media="(prefers-color-scheme: light)" href=hegz.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=hegz.io/syntax-theme-dark.css rel=stylesheet><script src="hegz.io/closable.js?h=e3a98d0f9c629052647c" defer></script><script src="hegz.io/audio.js?h=447b8407fc3ba02d588d" defer></script><script src="hegz.io/copy-button.js?h=16a6111418827d9f21b0" defer></script><script src="hegz.io/elasticlunr.min.js?h=4f648b9e42abdef9c436" defer></script><script src="hegz.io/search.js?h=d734b6553091d2823728" defer></script><meta content=SC-Wiki property=og:site_name><meta content="Masking - SC-Wiki" property=og:title><meta content=hegz.io/masking/ property=og:url><meta content="The man in the iron mask" property=og:description><meta content="hegz.io/card.png?h=2fe31b1f2af61cc1b896" property=og:image><meta content=en_GB property=og:locale><meta content=summary_large_image name=twitter:card><meta content="Masking - SC-Wiki" name=twitter:title><meta content=hegz.io/masking/ name=twitter:url><meta content="The man in the iron mask" name=twitter:description><meta content="hegz.io/card.png?h=2fe31b1f2af61cc1b896" name=twitter:image><body><a href=#main-content id=skip-to-content tabindex=0>Skip to Main Content</a><div class=sidebar id=site-navbar><a href=#top id=navbar-header><i class="ph-bold ph-arrow-line-up"></i><div><span>Masking</span><span>Back to top</span></div> </a><nav class=overshoot><ul><li><a href=hegz.io/> <i class="ph-bold ph-house"></i>SC-Wiki</a><li><a href=hegz.io/nanolog/> <i class="ph-bold ph-pencil"></i>Nanolog</a></ul></nav><div id=navbar-buttons><input autocomplete=off class=visually-hidden id=toggle-navbar name=toggle-navbar type=checkbox><label for=toggle-navbar><i class="ph-bold ph-sidebar"></i>Toggle Sidebar</label><button id=search><i class="ph-bold ph-magnifying-glass"></i>Search</button></div></div><main class=has-navbar id=main-content><div class=container><article><h1 id=heading>Masking</h1><div class=article-details><div class=item><i class="ph-bold ph-clock-countdown"></i><span>3 minutes</span></div><div class="item tags"><ul><li><a href=hegz.io/tags/masking/>Masking</a></ul></div></div><aside id=toc><strong class=title>Table of Contents</strong><div class=overshoot><ul><li><a href=hegz.io/masking/#introduction>Introduction</a><ul><li><a href=hegz.io/masking/#examples-of-masking-types>Examples of Masking Types</a></ul><li><a href=hegz.io/masking/#attacking-masked-implementations>Attacking Masked Implementations</a><ul><li><a href=hegz.io/masking/#pre-processing>Pre-processing</a></ul></ul></div></aside><h1 id=introduction>Introduction</h1><p>A masking algorithm is a circuit compiler, it transforms a circuit like the following:<ol><li>wire to protect in original circuit -> set of wires (shares)<li>each gate -> gadget</ol><p>Goal is to split the sensitive wires into <code>d + 1</code> shares, and to replace any with gadgets that perform the original operation except with these shares as inputs.<p>This makes attacks more difficult as we can’t just measure traces from a random point in the circuit since we now need to leak a wire and all its shares, then combine them to recover the original signal.<h2 id=examples-of-masking-types>Examples of Masking Types</h2><ol><li>Additive/Boolean Masking<li>Multiplicative Masking<li>Affine Masking<li>Inner Product Masking<li>and more..</ol><h1 id=attacking-masked-implementations>Attacking Masked Implementations</h1><p>Higher Order DPA attacks work very similarly to the normal first order attacks, the difference is in the pre-processing step.<h2 id=pre-processing>Pre-processing</h2><p>The core principle to recombine the mask shares so we can undo the “masking” effect, to do that we need to know which intermediate values are the masked shares that we care about.<p>Assuming we are attacking a second-order masking scheme which uses two shares for each protected input, let’s call each of these shares <code>u</code> and <code>v</code>, if we was able to locate <code>u</code> and <code>v</code> in our power trace, then we can just recombine them to recover the original value.<p>This is usually done using a recombination function, for boolean masking the most popular one is the XOR function, so this means that our unmasked value is <code>u ^ v</code>.<p><img alt src=hegz.io/masking/./assets/triu.png#end> The problem usually is finding the indices of these intermediate values though, one way to go about this is to just try all the possible indices. This is called the second order triangular matrix.<p>This matrix has all the different combinations of intermediate values whose length can be calculated by the formula <code>(l*l/2)</code> where l is the number of samples in a trace. One caveat though is that we need to skip the diagonal since we don’t care about intermediate combinations with themselves (i.e. u_1 xor u_1 or v_1 xor v_1, etc..).<p>This means that our matrix length is actually <code>n_samples*(n_samples-1)/2</code>, we can generate this matrix in numpy using:<pre class="language-python z-code" data-lang=python><code class=language-python data-lang=python><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">i_upper</span></span>, <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">j_upper</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">np</span></span><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">triu_indices</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">n_samples</span></span><span class="z-punctuation z-separator z-arguments z-python">,</span> <span class="z-variable z-parameter z-python">k</span><span class="z-keyword z-operator z-assignment z-python">=</span><span class="z-constant z-numeric z-integer z-decimal z-python">1</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
</span></code></pre><p>where <code>i_upper</code> and <code>j_upper</code> are both index masks of length <code>l*(l-1)/2</code> and each point in these vectors represents a different combination of u and v, which means that combining our traces becomes as simple as:<pre class="language-python z-code" data-lang=python><code class=language-python data-lang=python><span class="z-source z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">traces_second_order</span></span> <span class="z-keyword z-operator z-assignment z-python">=</span> <span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">traces</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-punctuation z-separator z-slice z-python">:</span>, <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">i_upper</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span> <span class="z-keyword z-operator z-arithmetic z-python">^</span> <span class="z-meta z-item-access z-python"><span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">traces</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-begin z-python">[</span></span><span class="z-meta z-item-access z-arguments z-python"><span class="z-punctuation z-separator z-slice z-python">:</span>, <span class="z-meta z-qualified-name z-python"><span class="z-meta z-generic-name z-python">j_upper</span></span></span><span class="z-meta z-item-access z-python"><span class="z-punctuation z-section z-brackets z-end z-python">]</span></span>
</span></code></pre><p>which will have a shape of <code>( n_traces, (n_samples*n_samples-1)/2 )</code></article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href=hegz.io/snr/> <div class=nav-arrow>Previous</div> <span class=post-title>A Study in SNR</span> </a><a class="post-nav-item post-nav-next" href=hegz.io/dpa/> <div class=nav-arrow>Next</div> <span class=post-title>DPA Overview</span> </a></nav></div></main><footer id=site-footer><div class=container><div><p id=site-footer-last-updated>25 April 2025, 11:20 (BST)</div></div></footer><div id=search-modal><div id=search-modal-content><label class=visually-hidden for=search-input>Search</label><div><input placeholder="Search for…" autocomplete=off id=search-input type=search><i class="ph-bold ph-keyboard" title="Press “/” to Open Search Bar"></i></div><div class=overshoot id=search-results></div></div></div><span class=hidden id=copy-code-text>Copy Code</span>